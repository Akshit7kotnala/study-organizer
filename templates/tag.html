{% extends 'base.html' %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="display-5">
      <i class="bi bi-tag-fill me-2 text-primary"></i>{{ tag.name }}
    </h1>
    <p class="text-muted">Documents tagged with "{{ tag.name }}"</p>
  </div>
  <div>
    <a class="btn btn-outline-secondary me-2" href="{{ url_for('tags_list') }}">
      <i class="bi bi-tags me-2"></i>All Tags
    </a>
    <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">
      <i class="bi bi-arrow-left me-2"></i>Home
    </a>
  </div>
</div>

<!-- Documents List -->
{% if documents %}
<div class="alert alert-info mb-4">
  <i class="bi bi-info-circle-fill me-2"></i>
  Found {{ pagination.total }} document{{ 's' if pagination.total != 1 else ''
  }} with this tag
</div>

<div class="list-group mb-4">
  {% for d in documents %}
  <div class="list-group-item doc-item">
    <div class="row align-items-center">
      <div class="col-auto">
        {% if d.thumbnail_filename %}
        <img
          src="{{ url_for('thumbnail_file', filename=d.thumbnail_filename) }}"
          alt="Thumbnail"
          class="img-thumbnail"
          style="width: 80px; height: 80px; object-fit: cover"
        />
        {% else %}
        <i class="{{ d.file_icon() }}" style="font-size: 2.5rem"></i>
        {% endif %}
      </div>
      <div class="col">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">{{ d.original_filename }}</h5>
          <small class="text-muted">
            <i class="bi bi-calendar-event me-1"></i>{{
            d.upload_date.strftime('%Y-%m-%d %H:%M') }}
          </small>
        </div>
        <p class="mb-1">
          <span class="badge bg-info me-2">
            <i class="bi bi-calendar3 me-1"></i>{{ human_year_label(d.year) }}
          </span>
          <span class="badge bg-primary me-2">
            <i class="bi bi-book me-1"></i>{{ d.subject }}
          </span>
          {% if d.tag_list() %} {% for other_tag in d.tag_list() %}
          <span
            class="badge {% if other_tag == tag.name %}bg-success{% else %}bg-secondary{% endif %} me-1"
          >
            <i class="bi bi-tag me-1"></i>{{ other_tag }}
          </span>
          {% endfor %} {% endif %}
        </p>
        <small class="text-muted">
          <i class="bi bi-hdd me-1"></i>Size: {{ d.format_size() }}
        </small>
      </div>
      <div class="col-auto">
        <div class="btn-group" role="group">
          <a
            class="btn btn-sm btn-outline-primary"
            href="{{ url_for('download', doc_id=d.id) }}"
            title="Download"
          >
            <i class="bi bi-download"></i> Download
          </a>
          <a
            class="btn btn-sm btn-outline-secondary"
            href="{{ url_for('preview', doc_id=d.id) }}"
            target="_blank"
            title="Preview"
          >
            <i class="bi bi-eye"></i> Preview
          </a>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Pagination -->
{% if pagination.pages > 1 %}
<nav aria-label="Document pagination">
  <ul class="pagination justify-content-center">
    <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
      <a
        class="page-link"
        href="{{ url_for('tag_view', slug=tag.slug, page=pagination.prev_num) }}"
      >
        <i class="bi bi-chevron-left"></i> Previous
      </a>
    </li>

    {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1,
    left_current=2, right_current=2) %} {% if page_num %}
    <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
      <a
        class="page-link"
        href="{{ url_for('tag_view', slug=tag.slug, page=page_num) }}"
      >
        {{ page_num }}
      </a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">...</span></li>
    {% endif %} {% endfor %}

    <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
      <a
        class="page-link"
        href="{{ url_for('tag_view', slug=tag.slug, page=pagination.next_num) }}"
      >
        Next <i class="bi bi-chevron-right"></i>
      </a>
    </li>
  </ul>
</nav>

<p class="text-center text-muted">
  Showing {{ (pagination.page - 1) * pagination.per_page + 1 }} to {{
  min(pagination.page * pagination.per_page, pagination.total) }} of {{
  pagination.total }} documents
</p>
{% endif %} {% else %}
<div class="alert alert-warning">
  <i class="bi bi-exclamation-triangle-fill me-2"></i>
  No documents found with tag "{{ tag.name }}"
</div>
{% endif %} {% endblock %}
